{% extends 'base.html' %}

{% block body %}
  <img src="https://image.tmdb.org/t/p/w500{{movie_data.poster_path}}" alt="...">
  {{movie_data.title}}
<button class="square_btn" onclick="history.back(-1);">뒤로가기</button>
<div class="backdrop row m-0 my-5">
  <div class="col-12 col-md-3 align-self-center" style="height: 100%;">
    <img src="https://image.tmdb.org/t/p/w500{{movie_data.poster_path}}" id="poster-img"  style="width: 100%;" alt="...">
    {% if user.is_authenticated %}
      <div class="position-absolute row align-items-center text-center rounded-circle bg-info mx-auto like-btn" data-pk="{{movie.pk}}" style="width: 3rem; height: 3rem; bottom: 0.5rem; left: 50%; transform: translateX(-50%);">
      {% if user in movie.like_users.all %}          
        <i class="mx-auto fas fa-heart fa-lg" data-pk="{{movie_data.pk}}" style="color:crimson"></i>
      {% else %}
        <i class="mx-auto fas fa-heart fa-lg" data-pk="{{movie_data.pk}}" style="color:white"></i>
      {% endif %}
      </div>
    {% endif %}
  </div>
  
  <div class="col-12 col-md-9 text-dark">
    <h3 class="mt-3 custom-break-word">{{ movie_data.title }}</h3>

    <hr>
    <pre class="custom-break-word">{{ movie_data.overview }}</pre>
    <hr>
    <div>{{ movie_data.release_date }} 개봉</div>
    <div>평점: {{ movie_data.vote_average }}</div>

    <hr>
  </div>
  
  <div class="embed-responsive embed-responsive-16by9">
    <iframe   
      class="embed-responsive-item"
      src='https://www.youtube.com/embed/{{ movie_data.video }}'
      frameborder="0" 
      allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" 
      allowfullscreen
    ></iframe>
  </div>
  
  


<style>

  .backdrop {
    position: relative;
    background-color: rgba(255, 255, 255, 0.7);
    
  }
  .backdrop::after {
    content: "";
    
    background: url('{{ backdrop_path }}') no-repeat;
    background-size: cover;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    position: absolute;
    z-index: -1;   
  }

</style>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script>
  var img = document.getElementById('poster-img')
  if (img.src.slice(31,img.src.length).indexOf('/') !== 0 ) {
    img.src = img.src.slice(31,img.src.length)
  }

  const likeBtns = document.querySelectorAll('.like-btn')
  likeBtns.forEach(function(btn) {
    btn.addEventListener('mouseover', function(event) {
      btn.getElementsByTagName('i')[0].classList.add('animate__animated', 'animate__rubberBand')

    })
    btn.addEventListener('mouseout', function(event) {
      btn.getElementsByTagName('i')[0].classList.remove('animate__animated', 'animate__rubberBand')

    })
    btn.addEventListener('click', function(event) {
      axios.get(`/movies/${btn.dataset.pk}/like`)
        .then(function(res) {
          if (res.data.liked) {
            btn.getElementsByTagName('i')[0].style.color = 'crimson'
          } else {
            btn.getElementsByTagName('i')[0].style.color = 'white'
          }
          const cntSpan = document.querySelector(`.cnt-${btn.dataset.pk}`)
          if (res.data.count) {
            cntSpan.innerText = res.data.count
          } else {

            cntSpan.innerText = 0
          }

        })
        .catch(function(err) {
          console.log(err)
        })
    })
  })

  function getOffsetTop(el) {
    var top = 0;
    if (el.offsetParent) {
      do {
        top += el.offsetTop;
      } while (el = el.offsetParent);
      return [top];
    }
  }
  window.scroll(0, getOffsetTop(document.getElementById("bookmark")));

</script>

{% endblock %}